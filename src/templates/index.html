<html>
<head>
    <title>Main page</title>
	
    <!--link href="{{ url_for('static', path='/styles.css') }}" rel="stylesheet"-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.css" />
	<script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.js"></script>
	
</head>
<body>
<div class = "container justify-content-center">

	<br>
	<div class='input-group mb-5'>
	<form id ="sendancor" action='http://localhost:8000/sendrq/' enctype="multipart/form-data" method="post">
		<h4>Укажите наименование товара и количество предсказаний</h4>
		<!--input type="file" name="file" id="file" accept=".jpg"  class="form-control" />
		<label for="email">Enter your email:</label-->
		<input type="text" id="desc" name="desc" />
		<input type="number" id="qtty" name="qtty" min='1' max='20' value='5' />
		<input type="submit" class="btn btn-primary" />
	</form>
	</div>
</div>
<div class = 'container' id ='logs'>

</div>
<div class = 'container'>
<table id="example" class="compact table" style="width:100%"><!--ui celled -->
        <thead>
            <tr>
                <th>Code</th>
                <th>Desc</th>
                <th>Prob</th>
				<th>Till</th>
            </tr>
        </thead>
        <!--tfoot>
            <tr>
                <th>Code</th>
                <th>Desc</th>
                <th>Prob</th>
            </tr>
        </tfoot-->
    </table>
</div><br><hr class="hr" />
<div class = 'container'>
	<div class='input-group mb-5'>
	<form id ="whatdata" action='http://localhost:8000/whatdata/' enctype="multipart/form-data" method="post">
		<h4>Укажите код или группу, чтобы посмотреть обучающую выборку</h4>
		<br>
		<!--input type="file" name="file" id="file" accept=".jpg"  class="form-control" />
		<label for="email">Enter your email:</label-->
		<input type="text" id="whatreq" name="whatreq" />
		<!--input type="number" id="qtty" name="qtty" min='1' max='20' value='5' /-->
		<input type="submit" class="btn btn-primary" />
	</form>
	</div>
</div>

<div class = 'container'>
<table id="example2" class="ui celled table" style="width:100%">
        <thead>
            <tr>
                <th>Code</th>
                <th>Desc</th>
            </tr>
        </thead>
    </table>
</div>
<br><br><br>
</body>

<script>

$(document).ready(function() {
let table = new DataTable('#example', {
	order: [[2, 'desc']],
	columns: [{ "width": "10%" }, null, { "width": "5%" }, { "width": "10%" }],
	columnDefs: [{target: 3, visible: false}],
	"createdRow": function( row, data, dataIndex){
		if( data[3] == 0){
			console.log(data);
			$(row).addClass('bg-danger');
		}
	}
});
let table2 = new DataTable('#example2', {'columns':[{'width': '10%'}, null]});
const form1  = document.getElementById('sendancor');
const form2 = document.getElementById('whatdata');
const logs = document.getElementById('logs');

form1.addEventListener('submit', (event) => {
    event.preventDefault();
	var desc = document.getElementById("desc").value
	
	var formData1 = new FormData(form1);
	console.log(formData1);
	$.ajax({
        url: 'http://localhost:8000/sendrq/',
        type: 'POST',
        data: formData1,
        async: false,
        cache: false,
        contentType: false,
        enctype: 'multipart/form-data',
        processData: false,
        success: function (response) {
			console.log(response);
			console.log(JSON.stringify(response));
			let data = JSON.stringify(response);
			//$('#example').DataTable().clear().rows.add(response['data']).draw();
			table.clear().rows.add(response['data']).draw();
        }
    });
});
form2.addEventListener('submit', (event) => {
	event.preventDefault();
	var whatreq = document.getElementById("whatreq").value
	var formData2 = new FormData(form2);
	console.log(whatreq);
	getTrainData(whatreq);
	
});
table.on('click', 'tbody tr', function () {
    let row_data = table.row(this).data();
    //alert('You clicked on ' + data[0] + "'s row");
	console.log('request of ' + row_data + ' code;');
	var code = row_data[0].toString();
	console.log(code);
	var data = {"id": code};
	getTrainData(code);
	/*$.ajax({
		url: 'http://localhost:8000/code/',
		type: 'POST',
		dataType : "json",
		contentType: "application/json; charset=utf-8",
		data : JSON.stringify(data),
		success: function (response){
			console.log(response);
			alert(response['data']);
		}
	});*/
});




function getTrainData(id){
	var data = {"id": id};
	$.ajax({
		url: 'http://localhost:8000/whatdata/',
		type: 'POST',
		dataType : "json",
		contentType: "application/json; charset=utf-8",
		data : JSON.stringify(data),
		success: function (response){
			console.log(response);
			//alert(response['data']);
			let data = JSON.stringify(response);
			//$('#example2').DataTable().clear().rows.add(response['data']).draw();
			table2.clear().rows.add(response['data']).draw();
		}
	});
}

});
</script>
</html>